#!/bin/bash

# Bashä»£ç†è‡ªåŠ¨é…ç½®æ–‡ä»¶
# å°†æ­¤æ–‡ä»¶æ·»åŠ åˆ°ä½ çš„ ~/.bashrc æˆ– ~/.bash_profile ä¸­

# è·å–è„šæœ¬æ‰€åœ¨ç›®å½•
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROXY_SCRIPT="$SCRIPT_DIR/proxy_manager.sh"

# æ£€æŸ¥ä»£ç†ç®¡ç†è„šæœ¬æ˜¯å¦å­˜åœ¨
if [[ -f "$PROXY_SCRIPT" ]]; then
    # åŠ è½½ä»£ç†ç®¡ç†è„šæœ¬
    source "$PROXY_SCRIPT"
    
    # å®šä¹‰å¿«æ·åˆ«å
    alias proxy='bash "$PROXY_SCRIPT"'
    alias proxy-on='proxy_on'
    alias proxy-off='proxy_off'
    alias proxy-status='proxy_status'
    
    # æ˜¾ç¤ºåŠ è½½ä¿¡æ¯ï¼ˆå¯é€‰ï¼Œå¦‚æœä¸æƒ³çœ‹åˆ°å¯ä»¥æ³¨é‡Šæ‰ï¼‰
    echo "ğŸ”§ ä»£ç†ç®¡ç†å·¥å…·å·²åŠ è½½"
    echo "   ä½¿ç”¨ 'proxy-on' å¯ç”¨ä»£ç†"
    echo "   ä½¿ç”¨ 'proxy-off' ç¦ç”¨ä»£ç†"
    echo "   ä½¿ç”¨ 'proxy-status' æŸ¥çœ‹çŠ¶æ€"
else
    echo "âš ï¸  è­¦å‘Š: ä»£ç†ç®¡ç†è„šæœ¬æœªæ‰¾åˆ°: $PROXY_SCRIPT"
fi

# å¯é€‰: è®¾ç½®Gitä»£ç†å‡½æ•°
git_proxy_on() {
    if [[ -n "$http_proxy" ]]; then
        git config --global http.proxy "$http_proxy"
        git config --global https.proxy "$https_proxy"
        echo "âœ“ Gitä»£ç†å·²å¯ç”¨"
    else
        echo "âš ï¸  è¯·å…ˆå¯ç”¨ç³»ç»Ÿä»£ç†"
    fi
}

git_proxy_off() {
    git config --global --unset http.proxy
    git config --global --unset https.proxy
    echo "âœ— Gitä»£ç†å·²ç¦ç”¨"
}

# æ·»åŠ Gitä»£ç†åˆ«å
alias git-proxy-on='git_proxy_on'
alias git-proxy-off='git_proxy_off'